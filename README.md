# HeyMax Client Analytics
This repository contains code for the HeyMax Client Analytics dashboard, including data ingestion pipeline, metric computation and plotting functions, and dash dashboard for metric visualization.

## Install and Setup
### Initial Setup
To set up the dashboard environment, create and activate a new conda environment, create a new PostgreSQL database cluster, and create a new user and database by running the following commands:
```
conda env create -f environment.yml
conda activate heymax
initdb -D data\postgres
pg_ctl -D data\postgres -l data\logs\logfile start
createuser --pwprompt admin_user
createdb --owner=admin_user client_db
```

### Running the Ingestion pipeline
Run the following command to ingest raw data as either an initial load or a daily batch. This script can be scheduled with either the Windows Task Scheduler or cron to automate daily data ingestion.
```
python src\data\ingest.py
```

### Running the Application
Once initial setup is complete and the data has been ingested, you can run the application by running the following commands in your conda terminal.

1. Start the postgreSQL server (if server is not running)
```
pg_ctl -D data\HeyMax -l data\logs\logfile start
```
2. Run the dash application
```
python src\app.py
```

## Repository Structure
```
|-- .env
|-- .gitignore
|-- environment.yml
|-- License
|-- README.md
|-- data/
|   |-- HeyMax/
|   |-- logs/
|   |-- raw/
|-- references/
|-- src/
|   |-- config/
|   |-- data/
|   |-- metrics/
|   |--  plot/
|   |-- ui/
|   |   |-- assets/
|   |   |-- components/
|   |   |-- pages/
|   |   |-- utils/
|   |-- app.py
```

### data
The top level `data` directory contains data required to support the client analytics dashboard. This is split into the following subdirectories:
- ***logs***: Logs generated by the data ingestion pipeline and the PostgreSQL database.
- ***postgres***: PostgreSQL database data.
- ***raw***: Original, raw user event data.
Raw data, postgreSQL database files and logs.

### references
The `references` directory contains data dictionaries and any other explanatory materials.

### src
The `src` directory houses the source code for this project and is organized as follows:

- ***config***: Repo level configs.
- ***data***: Data ingestion pipeline.
- ***metrics***: Metric computation functions.
- ***plot***: Metric plotting functions.
- ***ui***: Dash application specific files.
  - ***assets***: .css files, logos and locally hosted images.
  - ***components***: Common components used throughout the application.
  - ***pages***: Individual pages of the application. User guide related pages are in the *guides* subdirectory.
  - ***utils***: Common functions used through the application.
